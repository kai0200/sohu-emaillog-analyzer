调用顺序

- 250送达 → SPF错误 → HELO错误 → 无相关日志
- 这样可避免“无相关日志”抢先命中而屏蔽更具体的结论（如 SPF、HELO）
运行示例

- 无相关日志：
  - python analyze_logs.py --log samples/case1.txt --sender '@twitter.com' --recipient 'tianjiazhou@sohu.com'
- 250送达：
  - python analyze_logs.py --log samples/case2.txt --sender acxzy@sohu.com --recipient Ylinda@vtb.ru
  - python analyze_logs.py -l .\samples\case8.txt -s webmaster@vip.sohu.com -r xdlyb@qq.com 
- SPF错误：
  - python analyze_logs.py --log samples/case3.txt --sender gulw@ydamc.com --recipient 18655335713@sohu.com
- HELO错误：
  - python analyze_logs.py --log samples/case4.txt --sender puxiaolu@foton.com.cn --recipient lu_184@sohu.com


文件位置

- 模块文件： checks/*.py
- 主程序： analyze_logs.py
- 示例日志： samples/case*.txt
扩展建议

- 为每个模块提供统一接口 run(text, sender, recipient) -> bool （已实现），后续新增检查只需添加新文件并在主程序中引入
- 若后续检查共享工具函数，可再抽取 checks/common.py 以减少重复逻辑


单元测试

- (TraeAI-3) ~/Documents/sohu-emaillog-analyzer [5]

$ python -m unittest discover -s tests -p "test*.py" -q

helo=<mailgwin.foton.com.cn>
发件人：puxiaolu@foton.com.cn
处理建议：请联系运维工程师增加helo白名单
无相关日志，联系发件人确认
发信时间：Nov 12 16:51:12
发件人：gscc@substack.com
收件人：lu_184@sohu.com
status：250 2.0.0 OK
发件人：gulw@ydamc.com
结果：SPF错误


新增模式

- 支持位置参数： python analyze_logs.py <LOG_FILE> <SENDER> <RECIPIENT>
- 保留原有可选参数： python analyze_logs.py --log <LOG_FILE> --sender <SENDER> --recipient <RECIPIENT>
实现说明

- 参数解析增加位置参数收集，长度为 3 时优先生效
- 若位置参数未提供，则回退至原有 --log/--sender/--recipient 解析
- 任一参数缺失时输出简要用法并退出
变更位置

- 参数解析与分派： analyze_logs.py:14-33
- 检查调用沿用同一变量： analyze_logs.py:25-33
验证

- 语法检查通过： python -m py_compile analyze_logs.py
- 适配你示例： python analyze_logs.py samples/case4.txt puxiaolu@foton.com.cn lu_184@sohu.com
如需在用法提示中加入更详细示例或支持短参数别名（如 -l/-s/-r ），可以继续扩展解析。

sent250 bug问题说明

bug问题说明
sent_250无法满足正确的查询， 发件人和收件人不在同一行无法进行处理确认。 

./remote_mail_grep.sh  $email_address $email_date > /tmp/b.log 

解决方案：
1. 修改remote_mail_grep.sh 增加正则模式，同时查询收件人发件人
2. 通过analyze_qid.sh 通过qid查询，from 和to 搜取全部id然后相同的组合为一行。
3. 把搜出的内容追加到/tmp/a.log 让后续的analyze_logs.py 进行分析
   "python.exe analyze_logs.py -l .\samples\case8.txt -s webmaster@vip.sohu.com -r xdlyb@qq.com"
"""
QID：4dGzry1Kssz4wHS
From: from=<webmaster@vip.sohu.com>
To: to=<xdlyb@qq.com>
Status: bounced
Said: 550 Mailbox not found. http://service.mail.qq.com/detail/122/169 [MEuTjCSpGbjROIt5SpooW3KWgwR3WyyEE1ON7uwxGLdN3w+stYZm26/pLIwKHggEiQ== IP: 116.130.217.68] (in reply to RCPT TO command
Filter logs:
  Nov 27 09:50:10 proxy_18_88_88 free_milter_server.py[line: 221] FreeMailMilterSmtp INFO 7850ec60b6a64de59e17fbe6241ed3e8|8080|OnEndHeaders|qid:4dGzry1Kssz4wHS|cmdfrom:webmaster@vip.sohu.com|msgfrom:webmaster <webmaster@vip.sohu.com>|rcpt:['xdlyb@qq.com']|vps_ip:10.18.88.38|subject:回复:用户邮箱数据不存在，可能已注销|vps_port:58924|msgsender:webmaster@vip.sohu.com
"""
还需要做个整体测试，收发问题 - 20251127